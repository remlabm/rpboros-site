jQuery.fn.extend({captify:function(d){var c=$.extend({speedOver:"fast",speedOut:"normal",hideDelay:500,animation:"slide",prefix:"",opacity:"0.45",className:"caption-bottom",position:"bottom",spanWidth:"100%"},d);$(this).each(function(){var a=this;$(this).load(function(){if(a.hasInit){return false}a.hasInit=true;var A=false;var r=false;var x=$("#"+$(this).attr("rel"));var y=!x.length?$(this).attr("alt"):x.html();x.remove();var w=this.parent&&this.parent.tagName=="a"?this.parent:$(this);var B=w.wrap("<div></div>").parent().css({overflow:"hidden",padding:0,fontSize:0.1}).addClass("caption-wrapper").width($(this).width()).height($(this).height());$.map(["top","right","bottom","left"],function(e){B.css("margin-"+e,$(a).css("margin-"+e));$.map(["style","width","color"],function(g){var f="border-"+e+"-"+g;B.css(f,$(a).css(f))})});$(a).css({border:"0 none"});var b=$("div:last",B.append("<div></div>")).addClass(c.className);var s=$("div:last",B.append("<div></div>")).addClass(c.className).append(c.prefix).append(y);$("*",B).css({margin:0}).show();var u=jQuery.browser.msie?"static":"relative";b.css({zIndex:1,position:u,opacity:c.animation=="fade"?0:c.opacity,width:c.spanWidth});if(c.position=="bottom"){var t=parseInt(b.css("border-top-width").replace("px",""))+parseInt(s.css("padding-top").replace("px",""))-1;s.css("paddingTop",t)}s.css({position:u,zIndex:2,background:"none",border:"0 none",opacity:c.animation=="fade"?0:1,width:c.spanWidth});b.width(s.outerWidth());b.height(s.height());var q=c.position=="bottom"&&jQuery.browser.msie?1:0;var v=c.position=="top"?{hide:-$(a).height()-b.outerHeight()-1,show:-$(a).height()}:{hide:0,show:-b.outerHeight()+q};s.css("marginTop",-b.outerHeight());b.css("marginTop",v[c.animation=="fade"||c.animation=="always-on"?"show":"hide"]);var z=function(){if(!A&&!r){var e=c.animation=="fade"?{opacity:0}:{marginTop:v.hide};b.animate(e,c.speedOut);if(c.animation=="fade"){s.animate({opacity:0},c.speedOver)}}};if(c.animation!="always-on"){$(this).hover(function(){r=true;if(!A){var e=c.animation=="fade"?{opacity:c.opacity}:{marginTop:v.show};b.animate(e,c.speedOver);if(c.animation=="fade"){s.animate({opacity:1},c.speedOver/2)}}},function(){r=false;window.setTimeout(z,c.hideDelay)});$("div",B).hover(function(){A=true},function(){A=false;window.setTimeout(z,c.hideDelay)})}});if(this.complete||this.naturalWidth>0){$(a).trigger("load")}})}});